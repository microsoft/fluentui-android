jobs:
  - job: Localize
    pool:
      vmImage: ubuntu-latest

    steps:
    - task: Bash@3
      displayName: Localize
      env:
        TDBUILD_TEAM_ID: $(TDBUILD_TEAM_ID)
        TDBUILD_AAD_APPLICATION_CLIENT_ID: $(TDBUILD_AAD_APPLICATION_CLIENT_ID)
        TDBUILD_AAD_APPLICATION_CLIENT_SECRET: $(TDBUILD_AAD_APPLICATION_CLIENT_SECRET)
      inputs:
        targetType: 'inline'
        script: |
            touch test.txt
      
    - task: Bash@3
      displayName: Create PR
      env:
          GH_TOKEN: $(GH_TOKEN)
      inputs:
        targetType: 'inline'
        script: |
            set -e
            echo "Start."
            # Configure git and Push updates
            git config --global user.email pyeruva@microsoft.com
            git config --global user.name PraveenKumar Yeruva
            git config pull.rebase false
            branch=testLocalize-$(date +%s)
            git branch
            echo "Creating branch $branch"
            git branch $branch
            echo "Checkout $branch"
            git checkout $branch
            # Add / update and commit
            git status
            echo "adding files"
            git add .
            if [[ `git status --porcelain` ]]; then
                echo "Adding git commit"
                git commit -m 'Test Localization [skip ci]'
                echo "Pushing to origin"
                git push origin HEAD
                echo "Creating PR"
                gh api \
                --method POST \
                -H "Accept: application/vnd.github+json" \
                /repos/$(GITHUB_REPOSITORY)/pulls \
                -f title="LocalizationTitle" \
                -f body="Message Body" \
                -f head="$branch" \
                -f base='main'
            else
                echo "No changes since last run"
            fi